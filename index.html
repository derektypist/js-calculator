<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>JavaScript Calculator</title>
    <!-- Load Style Sheets -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <style>
        /* Body */

        body {
            font-family: "Roboto", Arial, Verdana, sans-serif;
            margin-top: 3em;
        }

        /* Calculator */

        #calculator {
            width: 50%;
            margin: auto;
           
        }

        /* Title */

        #title {
            background: black;
            font-size: 1.3em;
            color: white;
            text-align: center;
        }

        #title p {
            margin: auto;
           

        }

        /* Display and History */

        #display {
            height: 75px;
            background: seagreen;
            color: white;
        }

        #history {
            height: 40px;
            background: seagreen;
            color: white;
            border: none;
        }

        #display p,
        #history p {
            padding-right: 20px;
            padding-top: 15px;
            margin-bottom: 0;
            margin-top: 0;
        }

        .row,
        #display,
        #history {
            text-align: right;
        }

        /* Buttons */

        #clear {
            color: turquoise;
        }
        
        #settings {
            color: orange;
        }

        button {
            font-size: 2em;
            background: black;
            color: white;
            border-color: lightgreen;
            margin-left: 0px;
            margin-right: 0px;
            height: 2em;
            float: left;
        }

        button:hover {
            background: navy;
            color: white;
        }

        #equal:hover {
            background: turquoise;
        }
        
        #clear:hover {
            background: green;
        }
        
        #settings:hover {
            background: purple;
        }

        .row button {
            width: 25%;
        }

        
    </style>

    <!-- Load Scripts -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://www.jsdelivr.com/package/npm/mathjs"></script>
    <script>
    
        $(document).ready(function() {
        // Define Global Variables
        
        var $display = $("#display");
        var $history = $("#history");
        var $clear = $("#clear");
        var text = "";
        var numText = "";
        var operation = "";
        var numArray = [];
        var iterations = 0;
        const DISPLAY_BACKGROUND_COLORS = ["seagreen", "blue", "purple", "orange", "olive", "brown", "darkpink"];
        BigNumber.config({
            DECIMAL_PLACES: 10,
            ROUNDING_MODE: BigNumber.ROUND_HALF_CEIL,
            EXPONENTIAL_AT: [-10, 10],
            ERRORS: false,
        });

        /* FONT SCALING */
        //Scales font size on main display in case of long numbers

        function fontSizing() {
            var fontSize;
            if ($display.children().text().length > 18) {
                fontSize = $display.width() * 0.05; // 5% of display div width
            }
            else if ($display.children().text().length > 13) {
                fontSize = $display.width() * 0.07; // 7% of display div width
            }
            else {
                fontSize = $display.width() * 0.10; // 10% of display div width
            }
            $display.css('font-size', fontSize);
        }

        // Set Up Number Buttons

        $(".digit:not(#zero)").click(function() {
            
            if (operation == "equal") {
                text += $(".digit:not(#zero)").html();
                numText += $(".digit:not(#zero)").html();
                operation = "number";
            } else if (lockNumbersAndDecimals()){
                // Apply Lock to Numbers and Decimals
            } else {
            /(\s0)|x|\+|—/.test($output.text()) ? $display.html('') : $display.html();
            text += $(".digit:not(#zero)").html();
                numText += $(".digit:not(#zero)").html();
                displayText();
                displayHistory();
                operation = "number";
            
            
            
            }
        });
        $("#zero").click(function() {
            if (operation == "equal") {
                initializeCalc();
            } else if (/(\s0)$|-$|x|\+|—/.test($display.text()) ||
      lockNumbersAndDecimals()) { // PREVENTS UNWANTED ZEROS
    } else {
                text += $("#zero").append("0");
                numText += $("#zero").append("0");
                displayText();
                displayHistory();
                operation = "number";
            }
                
            });
       
        
       // Set Up Decimal Point
       
       $("#decimal").click(function() {
           
           if (operation == "equal") {
               $history.html($(this.text()));
               operation = "decimal";
           }
           
       });

       // Set Up Lock Function
       
      function lockNumbersAndDecimals() {
          if (operation != "equal") {
              return $display.text().length > 18 ||
              $history.text().length > 64 ||
              $history.text() !== "";
              
          }
      }
        

        // Set Up Operations Buttons

        $("#posNeg").click(function() {
            var bigNum = new BigNumber($display.children().html());
            text = bigNum.toNumber() * -1;
            displayText();
            displayHistory();
            clear();
        });

        $("#add").click(function() {
            equal(); //call equal to perform current operation before switching to new operation
            operation = "add";
            add();
            numText += " " + $("#add").html() + " ";
            clear();
        });

        $("#subtract").click(function() {
            equal();
            operation = "subtract";
            subtract();
            numText += " " + $("#subtract").html() + " ";
            clear();
        });

        $("#divide").click(function() {
            equal();
            operation = "divide";
            divide();
            numText += " " + $("#divide").html() + " ";
            clear();
        });

        $("#multiply").click(function() {
            equal();
            operation = "multiply";
            multiply();
            numText += " " + $("#multiply").html() + " ";
            clear();
        });

        $("#percent").click(function() {
            operation = "percent";
            percent();
            equal();
            numText += " " + $("#percent").html() + " ";
            clear();
        });

        // Set Up Operations Functions

        function add() {
            if ($display.children().html() !== undefined) {
                var bigNum = new BigNumber($display.children().html());
                numArray.push(bigNum.toNumber());
            }
            else {
                numArray.push(0);
            }
            console.log(numArray);
            //if numArray only has one number, don't perform any operations
            if (numArray.length === 1) {
                text = numArray[0];
                console.log(numArray);
                displayText();
            }
            else {
                numArray = [numArray.reduce(function(prev, curr) {
                    prev = new BigNumber(prev);
                    curr = new BigNumber(curr);
                    return math.add(math.bignumber(prev), math.bignumber(curr));
                })];
                text = numArray[0];
                console.log(numArray);
                displayText();
            }
        }

        function subtract() {
            if ($display.children().html() !== undefined) {
                var bigNum = new BigNumber($display.children().html());
                numArray.push(bigNum.toNumber());
            }
            else {
                numArray.push(0);
            }
            console.log(numArray);
            if (numArray.length === 1) {
                text = numArray[0];
                console.log(numArray);
                displayText();
            }
            else {
                numArray = [numArray.reduce(function(prev, curr) {
                    prev = new BigNumber(prev);
                    curr = new BigNumber(curr);
                    return math.subtract(math.bignumber(prev), math.bignumber(curr));
                })];
                text = numArray[0];
                console.log(numArray);
                displayText();
            }
        }

       function multiply() {
  if ($display.children().html() !== undefined) {
    var bigNum = new BigNumber($display.children().html());
    numArray.push(bigNum.toNumber());
  } else {
    numArray.push(0);
  }
  console.log(numArray);
  if (numArray.length === 1) {
    text = numArray[0];
    console.log(numArray);
    displayText();
  } else {
    numArray = [numArray.reduce(function(prev, curr) {
      prev = new BigNumber(prev);
      curr = new BigNumber(curr);
      return math.multiply(math.bignumber(prev), math.bignumber(curr));
      
    })];
    text = numArray[0];
    console.log(numArray);
    displayText();
  }
}
        
        function divide() {
  if ($display.children().html() !== undefined) {
    var bigNum = new BigNumber($display.children().html());
    numArray.push(bigNum.toNumber());
  } else {
    numArray.push(0);
  }
  console.log(numArray);
  if (numArray.length === 1) {
    text = numArray[0];
    console.log(numArray);
    displayText();
  } else {
    numArray = [numArray.reduce(function(prev, curr) {
      prev = new BigNumber(prev);
      curr = new BigNumber(curr);
      return math.divide(math.bignumber(prev), math.bignumber(curr));
    })];
    text = numArray[0];
    console.log(numArray);
    displayText();
  }
}

        function percent() {
  if ($display.children().html() !== undefined) {
    var bigNum = new BigNumber($display.children().html());
    numArray.push(bigNum.toNumber());
  } else {
    numArray.push(0);
  }
  console.log(numArray);
  numArray = [numArray.reduce(function(prev, curr) {
    prev = new BigNumber(prev);
    curr = new BigNumber(100);
    return math.divide(math.bignumber(prev), math.bignumber(curr));
  })];
  text = numArray[0];
  console.log(numArray);
  displayText();
}

//Equal calls the last operation performed
function equal() {
  console.log(operation);
  if (operation === "plus") {
    add();
  } else if (operation === "minus") {
    subtract();
  } else if (operation === "multiply") {
    multiply();
  } else if (operation === "divide") {
    divide();
  } else if (operation === "percent") {
    percent();
  }
  operation = "";
  numArray = [];
}



// Initialize Calculator
function initializeCalc() {
$display.html(' 0');
$history.html('');
operation = undefined;
}

        
       

// Set Up Equal, Clear and Settings Buttons
$("#equal").click(function() {
    if($history.html().lastIndexOf('.') == $history.html().length - 1 || operation === undefined) {
        // Prevent Evaluation
    } else {
        equal();
        $history.empty();
        operation = "equal";
        numText = text;
    }
    
    
    
});  



// Clear Button will reset everything
$("#clear").click(initializeCalc());

function clear() {
    text = "";
}

$("#settings").click(changeDisplayBackgroundColor());

function changeDisplayBackgroundColor() {
    iterations++;
    $("#settings").css("background-color", DISPLAY_BACKGROUND_COLORS[iterations % 7]);
}

// Display Functions
function displayText() {
    var displayTags = "<p>";
    displayTags += text;
    displayTags += "</p>";
    fontSizing();
    $display.html(displayTags);
}

function displayHistory() {
    var historyText = "<p>";
    historyText += numText;
    historyText += "</p>";
    $history.html(historyText);
}

// Settings Functions

        
        });         // End Document Ready
        </script> 
</head>

<body>
    <!-- Set Up Calculator -->
    <section class="container-fluid" id="calculator">
        <!-- Set Up Title, History and Display -->
        <article id="title">
            <p>JavaScript Calculator</p>
        </article>
        <article id="history"></article>
        <article id="display"> 0</article>
        <!-- Set Up First Row -->
        <article class="row">
            <button id="clear">C</button>
            <button id="posNeg">&plusmn;</button>
            <button id="percent">%</button>
            <button id="divide" class="op">&divide;</button>
        </article>

        <!-- Set Up Second Row -->
        <article class="row">
            <button id="one" class="digit" >1</button>
            <button id="two" class="digit">2</button>
            <button id="three" class="digit">3</button>
            <button class="op" id="add">+</button>
        </article>

        <!-- Set Up Third Row -->
        <article class="row">
            <button id="four" class="digit">4</button>
            <button id="five" class="digit">5</button>
            <button id="six" class="digit">6</button>
            <button class="op" id="subtract">-</button>
        </article>

        <!-- Set Up Fourth Row -->
        <article class="row">
            <button id="seven" class="digit">7</button>
            <button id="eight" class="digit">8</button>
            <button id="nine" class="digit">9</button>
            <button class="op" id="multiply">&times;</button>
        </article>

        <!-- Set Up Fifth Row -->
        <article class="row">
            <button id="zero" class="digit">0</button>
            <button id="decimal">.</button>
            <button class="op" id="equal">=</button>
            <button id="settings" title="Change display background color">S</button>
        </article>
    </section>
</body>

</html>
